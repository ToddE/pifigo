#!/bin/bash
set -e

echo "Running post-removal script for pifigo..."

# Clean up files generated by the application that dpkg doesn't know about.
echo "Cleaning up generated configuration files..."
rm -f /etc/netplan/99-pifigo-client.yaml
rm -f /etc/pifigo/last-good-wifi.yaml
rm -f /etc/netplan/01-pifigo-hotspot.yaml.bak # Cleanup sed backup

# If the user is "purging" the package, remove the entire saved_networks directory.
if [ "$1" = "purge" ]; then
    echo "Purging saved network profiles and logs..."
    rm -rf /etc/pifigo/saved_networks
    # You might also want to remove /var/log/pifigo if you add file logging
fi

# Tell systemd to reload its configuration to forget about the removed service.
echo "Reloading systemd daemon..."
systemctl daemon-reload

echo "pifigo cleanup complete."

exit 0
